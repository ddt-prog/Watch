<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø´ØºÙ„ Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø§Ø¬Ù†Øª</title>
    <style>
        body { font-family: sans-serif; background: #1a1a1a; color: white; text-align: center; padding: 20px; }
        .container { max-width: 800px; margin: auto; background: #2d2d2d; padding: 20px; border-radius: 10px; }
        input { width: 80%; padding: 10px; border-radius: 5px; border: none; margin-bottom: 10px; }
        button { padding: 10px 20px; background: #27ae60; color: white; border: none; cursor: pointer; border-radius: 5px; }
        #status { margin: 20px 0; color: #f1c40f; }
        #output video { width: 100%; margin-top: 20px; border: 2px solid #444; }
        .log { font-size: 12px; color: #aaa; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸš€ Ù…Ø´ØºÙ„ Ø§Ù„Ù…Ø§Ø¬Ù†Øª Ø§Ù„Ø³Ø±ÙŠØ¹</h2>
    <p>Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø§Ø¬Ù†Øª (Magnet Link) Ù„Ù„Ø¨Ø¯Ø¡ ÙÙŠ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ø£Ùˆ Ø§Ù„ØªØ­Ù…ÙŠÙ„</p>
    
    <input type="text" id="magnetInput" placeholder="Ø¶Ø¹ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø§Ø¬Ù†Øª Ù‡Ù†Ø§...">
    <br>
    <button onclick="startDownload()">ØªØ´ØºÙŠÙ„ / ØªØ­Ù…ÙŠÙ„</button>

    <div id="status">Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø£Ù…Ø±...</div>
    
    <div id="output"></div>
    
    <div id="log" class="log"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/webtorrent@latest/webtorrent.min.js"></script>

<script>
    const client = new WebTorrent();

    function startDownload() {
        const magnetURI = document.getElementById('magnetInput').value;
        const status = document.getElementById('status');
        const output = document.getElementById('output');

        if (!magnetURI) {
            alert("ÙŠØ±Ø¬Ù‰ ÙˆØ¶Ø¹ Ø±Ø§Ø¨Ø· ØµØ­ÙŠØ­!");
            return;
        }

        status.innerHTML = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© (Peers)... ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±";
        output.innerHTML = ""; // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©

        client.add(magnetURI, function (torrent) {
            status.innerHTML = `Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„: ${torrent.name}`;
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ù„Ù ÙÙŠØ¯ÙŠÙˆ Ù„ØªØ´ØºÙŠÙ„Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
            const file = torrent.files.find(function (file) {
                return file.name.endsWith('.mp4') || file.name.endsWith('.mkv') || file.name.endsWith('.webm');
            });

            if (file) {
                // Ø¹Ø±Ø¶ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙÙŠ Ø§Ù„ØµÙØ­Ø©
                file.appendTo('#output', { autoplay: true, muted: false });
            }

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙƒÙ„ Ø«Ø§Ù†ÙŠØ©
            torrent.on('download', function (bytes) {
                status.innerHTML = `
                    <b>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„:</b> ${torrent.name} <br>
                    <b>Ø§Ù„Ø³Ø±Ø¹Ø©:</b> ${(torrent.downloadSpeed / 1024 / 1024).toFixed(2)} MB/s <br>
                    <b>Ø§Ù„ØªÙ‚Ø¯Ù…:</b> ${(torrent.progress * 100).toFixed(2)}%
                `;
            });
        });
    }

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
    client.on('error', function (err) {
        console.error('Error:', err.message);
        document.getElementById('status').innerHTML = "Ø®Ø·Ø£: " + err.message;
    });
</script>

</body>
</html>
